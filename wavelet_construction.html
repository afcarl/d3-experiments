<!DOCTYPE html>
<html>
  <head>
    <title>Wavelet Construction</title>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
  </head>

  <body>
    <style>

    </style>

    <svg width="960" height="500"></svg>

    <script>
      var h_0 = [0.12940952255092145, -0.22414386804185735, -0.836516303737469, -0.48296291314469025];

      function next_approximation(x_n, h_0) {
        var new_value_count = 2*x_n.length + h_0.length - 2;
        var new_x = Array(new_value_count).fill(0);

        for (var j = 0; j < new_value_count; j++) {
          var current_value = 0
          for (var k = 0; k < h_0.length; k++) {
            if ((j+k) % 2 == 0) {
              var i = (j-k) / 2;
              if(i >= 0 && i < x_n.length) {
                current_value = current_value + h_0[k] * x_n[i];
              }
            }
          }
          new_x[j] = current_value;
        }
        return new_x;
      }

      function shift_and_scale(phi, scale_coeff, num_approx) {
        var result = []
        var offset = Math.pow(2, num_approx);
        for (var i = 0; i < scale_coeff.length; i++) {
          var scaled = phi.map(function(d) { return d * scale_coeff[i]; })
          var start_buffer = Array(i*offset).fill(0);
          var end_buffer = Array((scale_coeff.length - 1 - i)*offset).fill(0);
          result.push(start_buffer.concat(scaled).concat(end_buffer));
        }

        return result;
      }

      var data = [1];
      var num_approx = 7
      var offset = Math.pow(2, num_approx);
      for (var i = 0; i < num_approx; i++) {
        data = next_approximation(data, h_0);
      }
      data = shift_and_scale(data, h_0, num_approx);
      var flat_data = [].concat.apply([], data);

      var svg = d3.select("svg"),
          margin = {top: 20, right: 20, bottom: 30, left: 40},
          width = +svg.attr("width") - margin.left - margin.right,
          height = +svg.attr("height") - margin.top - margin.bottom;

      var y = d3.scaleLinear().range([0, height]),
          x = d3.scaleLinear().range([0, width]);
      x.domain([0, data[0].length]);
      y.domain([d3.min(flat_data), d3.max(flat_data)]);
      var z = d3.scaleOrdinal(d3.schemeCategory10);

      var area = d3.area()
          .x(function(d, i) { return x(i);})
          .y1(function(d) { return y(d);})
          .y0(y(0));

      svg.selectAll("g")
          .data(data)
          .enter().append("g");

      svg.selectAll("g")
          .append("path")
          .attr("class", "area")
          .attr("d", function(d) { return area(d); })
          .attr("fill", function(d) { return z(d)});



    </script>
  </body>
</html>
